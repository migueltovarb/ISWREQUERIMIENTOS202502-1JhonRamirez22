{% extends "inventario/base.html" %}
{% block title %}{% if object %}Editar{% else %}Crear{% endif %} Producto{% endblock %}
{% block content %}
<div style="background: linear-gradient(135deg, #1976D2 0%, #1565C0 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 30px;">
    <h1 style="font-size: 32px; font-weight: 700;">{% if object %}‚úèÔ∏è Editar Producto{% else %}üì¶ Crear Nuevo Producto{% endif %}</h1>
</div>

<div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <form method="post">
        {% csrf_token %}
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            <div>
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">C√≥digo</label>
                <input type="text" name="codigo" value="{{ form.codigo.value|default:'' }}" required style="width: 100%; padding: 10px; border: 1px solid #E0E0E0; border-radius: 6px; font-size: 14px;" placeholder="PRD001" id="codigo">
            </div>
            <div>
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Nombre</label>
                <input type="text" name="nombre" value="{{ form.nombre.value|default:'' }}" required style="width: 100%; padding: 10px; border: 1px solid #E0E0E0; border-radius: 6px; font-size: 14px;" placeholder="Nombre del producto">
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            <div>
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Marca</label>
                <input type="text" name="marca" value="{{ form.marca.value|default:'' }}" required style="width: 100%; padding: 10px; border: 1px solid #E0E0E0; border-radius: 6px; font-size: 14px;" placeholder="Marca">
            </div>
            <div>
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Color</label>
                <select name="color" required style="width: 100%; padding: 10px; border: 1px solid #E0E0E0; border-radius: 6px; font-size: 14px;">
                    <option value="">Seleccionar color</option>
                    <option value="ROJO" {% if form.color.value == 'ROJO' %}selected{% endif %}>Rojo</option>
                    <option value="AZUL" {% if form.color.value == 'AZUL' %}selected{% endif %}>Azul</option>
                    <option value="NEGRO" {% if form.color.value == 'NEGRO' %}selected{% endif %}>Negro</option>
                    <option value="BLANCO" {% if form.color.value == 'BLANCO' %}selected{% endif %}>Blanco</option>
                    <option value="GRIS" {% if form.color.value == 'GRIS' %}selected{% endif %}>Gris</option>
                    <option value="VERDE" {% if form.color.value == 'VERDE' %}selected{% endif %}>Verde</option>
                </select>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            <div>
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Categor√≠a</label>
                <select name="categoria" required style="width: 100%; padding: 10px; border: 1px solid #E0E0E0; border-radius: 6px; font-size: 14px;">
                    <option value="OTROS" {% if form.categoria.value == 'OTROS' %}selected{% endif %}>Otros</option>
                    <option value="ELECTRONICA" {% if form.categoria.value == 'ELECTRONICA' %}selected{% endif %}>Electr√≥nica</option>
                    <option value="HERRAMIENTAS" {% if form.categoria.value == 'HERRAMIENTAS' %}selected{% endif %}>Herramientas</option>
                    <option value="VEHICULOS" {% if form.categoria.value == 'VEHICULOS' %}selected{% endif %}>Veh√≠culos</option>
                    <option value="OFICINA" {% if form.categoria.value == 'OFICINA' %}selected{% endif %}>Oficina</option>
                </select>
            </div>
            <div>
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Precio Unitario</label>
                <input type="number" step="0.01" name="precio" value="{{ form.precio.value|default:'' }}" required style="width: 100%; padding: 10px; border: 1px solid #E0E0E0; border-radius: 6px; font-size: 14px;" placeholder="0.00">
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            <div>
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Stock</label>
                <input type="number" name="stock" value="{{ form.stock.value|default:0 }}" min="0" required style="width: 100%; padding: 10px; border: 1px solid #E0E0E0; border-radius: 6px; font-size: 14px;">
            </div>
            <div>
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Stock M√≠nimo</label>
                <input type="number" name="stock_minimo" value="{{ form.stock_minimo.value|default:5 }}" min="0" required style="width: 100%; padding: 10px; border: 1px solid #E0E0E0; border-radius: 6px; font-size: 14px;">
            </div>
        </div>

        <div style="margin-bottom: 20px;">
            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Proveedor</label>
            <select name="proveedor" style="width: 100%; padding: 10px; border: 1px solid #E0E0E0; border-radius: 6px; font-size: 14px;">
                <option value="">Sin proveedor</option>
                {% for proveedor in form.proveedor.field.queryset %}
                <option value="{{ proveedor.id }}" {% if form.proveedor.value == proveedor.id|stringformat:"s" %}selected{% endif %}>{{ proveedor.nombre }}</option>
                {% endfor %}
            </select>
        </div>

        <div style="margin-bottom: 20px;">
            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Descripci√≥n</label>
            <textarea name="descripcion" style="width: 100%; padding: 10px; border: 1px solid #E0E0E0; border-radius: 6px; font-size: 14px; font-family: 'Segoe UI';" rows="3" placeholder="Descripci√≥n del producto">{{ form.descripcion.value|default:'' }}</textarea>
        </div>

        <div style="margin-bottom: 30px; padding: 20px; background: #F5F5F5; border-radius: 8px; border-left: 4px solid #1976D2;">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #333;">üìä C√≥digo de Barras </h3>
            <div id="barcode-preview" style="background: white; padding: 16px; border-radius: 6px; text-align: center; min-height: 80px; display: flex; align-items: center; justify-content: center;">
                <p style="color: #999; font-size: 14px;">Ingresa un c√≥digo para generar vista previa</p>
            </div>
            <p style="font-size: 12px; color: #666; margin-top: 12px; text-align: center;">
                ‚úì C√≥digo de barras generado autom√°ticamente para cada producto
            </p>
        </div>

        <div style="display: flex; gap: 12px;">
            <button type="submit" style="background: #1976D2; color: white; padding: 12px 24px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;">
                {% if object %}üíæ Guardar Cambios{% else %}‚úÖ Crear Producto{% endif %}
            </button>
            <a href="{% url 'inventario:listado' %}?rol={{ rol }}" style="background: #999; color: white; padding: 12px 24px; border: none; border-radius: 6px; font-weight: 600; text-decoration: none; font-size: 14px; display: inline-block;">‚ùå Cancelar</a>
        </div>
    </form>
</div>

<script>
// Generar vista previa de c√≥digo de barras (HU014)
document.getElementById('codigo').addEventListener('input', function(e) {
    const codigo = e.target.value;
    const preview = document.getElementById('barcode-preview');
    
    if (codigo.length > 0) {
        // Generar c√≥digo de barras simple basado en el c√≥digo
        const barcode = codigo.padEnd(13, '0').substring(0, 13);
        const bars = barcode.split('').map(digit => {
            return '<div style="display: inline-block; width: ' + (digit * 2) + 'px; height: 40px; background: black; margin: 0 1px;"></div>';
        }).join('');
        
        preview.innerHTML = `
            <div style="text-align: center;">
                <div>${bars}</div>
                <p style="font-size: 12px; color: #666; margin-top: 8px;">${barcode}</p>
            </div>
        `;
    } else {
        preview.innerHTML = '<p style="color: #999; font-size: 14px;">Ingresa un c√≥digo para generar vista previa</p>';
    }
});
</script>
{% endblock %}
